<section
  class="t2-proof {% if section.settings.full_bleed %}t2-proof--bleed{% endif %}"
  style="
    --bg: {{ section.settings.bg }};
    --fg: {{ section.settings.fg }};
    --card: {{ section.settings.card_bg }};
    --accent: {{ section.settings.accent }};
    --radius: {{ section.settings.radius }}px;
    --cols: {{ section.settings.columns }};
    --ava: {{ section.settings.avatar_size }}px;
  "
>
  <div class="t2-proof__inner">
    {% if section.settings.title != blank %}
      <h2 class="t2-proof__title">{{ section.settings.title | escape }}</h2>
    {% endif %}
    {% if section.settings.subtitle != blank %}
      <p class="t2-proof__subtitle">{{ section.settings.subtitle }}</p>
    {% endif %}

    {% assign layout = section.settings.layout %}
    <div class="t2-proof__wrap {% if layout == 'carousel' %}t2-proof__wrap--carousel{% else %}t2-proof__wrap--grid{% endif %}">
      {% assign lines = section.settings.items | newline_to_br | split: '<br />' %}

      {% for l in lines %}
        {% assign s = l | strip %}
        {% if s != '' %}
          {% assign f = s | split: '|' %}
          {% assign text   = f[0] | default: '' | strip %}
          {% assign author = f[1] | default: '' | strip %}
          {% assign role   = f[2] | default: '' | strip %}
          {% assign avatar = f[3] | default: '' | strip %}
          {% assign note_s = f[4] | default: '' | strip %}
          {% assign note   = 0 %}
          {% if note_s != '' %}{% assign note = note_s | plus: 0 %}{% endif %}

          <figure class="t2-quote {% if section.settings.border_style == 'glow' %}t2-quote--glow{% elsif section.settings.border_style == 'soft' %}t2-quote--soft{% endif %}">
            <div class="t2-quote__header">
              <div class="t2-quote__avatar">
                {% if avatar != '' %}
                  <img
                    src="{{ avatar | escape }}"
                    alt="{{ author | default: 'Avatar' | escape }}"
                    loading="lazy"
                    decoding="async"
                    width="{{ section.settings.avatar_size }}"
                    height="{{ section.settings.avatar_size }}"
                    style="aspect-ratio:1/1; object-fit:cover;">
                {% else %}
                  <svg width="{{ section.settings.avatar_size }}" height="{{ section.settings.avatar_size }}" viewBox="0 0 40 40" aria-hidden="true" class="t2-quote__avatar-ph">
                    <circle cx="20" cy="20" r="20" fill="#f3f4f6"/>
                    <circle cx="20" cy="16" r="8" fill="#d1d5db"/>
                    <path d="M6 36c3-7 9-11 14-11s11 4 14 11" fill="#d1d5db"/>
                  </svg>
                {% endif %}
              </div>

              <figcaption class="t2-quote__who">
                {% if author != '' %}<strong>{{ author }}</strong>{% endif %}
                {% if role != '' %}<span class="t2-quote__role">— {{ role }}</span>{% endif %}
              </figcaption>
            </div>

            {% if text != '' %}
              <blockquote class="t2-quote__text">“{{ text }}”</blockquote>
            {% endif %}

            {% if section.settings.show_rating and note > 0 %}
              {% assign stars_pct = note | times: 20 %}
              <div class="t2-rating" aria-label="{{ note }} out of 5">
                <span class="t2-stars"><span class="t2-stars__fg" style="width:{{ stars_pct }}%"></span></span>
              </div>
            {% endif %}
          </figure>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

<style>
/* Wrapper */
.t2-proof{ background:var(--bg,#f8fafc); color:var(--fg,#111827); }
.t2-proof__inner{ max-width:1200px; margin:0 auto; padding:28px 16px; }
.t2-proof--bleed{ position:relative; left:50%; right:50%; margin-left:-50vw; margin-right:-50vw; width:100vw; max-width:100vw; }

/* Titles */
.t2-proof__title{ margin:0 0 8px; font-weight:900; text-align:center; font-size:clamp(20px,3vw,28px) }
.t2-proof__subtitle{ margin:0 0 18px; text-align:center; opacity:.85 }

/* Layouts */
.t2-proof__wrap--grid{
  display:grid; gap:16px;
  grid-template-columns:repeat(var(--cols,3), minmax(0,1fr));
}
@media (max-width: 990px){ .t2-proof__wrap--grid{ grid-template-columns: repeat(2,1fr);} }
@media (max-width: 640px){ .t2-proof__wrap--grid{ grid-template-columns: 1fr;} }

/* Carousel (no JS) */
.t2-proof__wrap--carousel{
  display:grid; grid-auto-flow:column; grid-auto-columns: minmax(280px, 360px);
  gap:14px; overflow:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; padding-bottom:6px;
}
.t2-proof__wrap--carousel > .t2-quote{ scroll-snap-align:start }

/* Card */
.t2-quote{
  background:var(--card,#fff);
  border:1px solid #e5e7eb;
  border-radius:var(--radius,14px);
  padding:16px 14px;
  display:flex; flex-direction:column; gap:10px;
  position:relative;
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.t2-quote:hover{ transform:translateY(-2px); box-shadow:0 8px 22px rgba(0,0,0,.06); border-color:#e5e7eb; }

/* Borders */
.t2-quote--soft{ box-shadow:0 2px 10px rgba(0,0,0,.04) }
.t2-quote--glow{ box-shadow:0 10px 30px rgba(225,29,46,.15), 0 0 0 1px rgba(225,29,46,.08) }

/* Header (avatar + who) */
.t2-quote__header{ display:flex; align-items:center; gap:10px }
.t2-quote__avatar{ width:var(--ava,40px); height:var(--ava,40px); border-radius:50%; overflow:hidden; border:2px solid var(--accent,#e11d2e); flex:0 0 auto }
.t2-quote__avatar img{ width:100%; height:100%; object-fit:cover; display:block }
.t2-quote__avatar-ph{ display:block; border-radius:50%; overflow:hidden }
.t2-quote__who{ display:flex; align-items:baseline; gap:6px }
.t2-quote__role{ opacity:.7 }

/* Text */
.t2-quote__text{ margin:0; line-height:1.55 }

/* Stars */
.t2-rating{ display:flex; align-items:center }
.t2-stars{ --s: 14px; position:relative; display:inline-block; width:calc(var(--s)*5); height:var(--s);
  background:linear-gradient(90deg,#ddd 0 100%);
  -webkit-mask:repeat-x url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"><path fill="black" d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>') left/var(--s) 1 no-repeat;
}
.t2-stars__fg{ position:absolute; inset:0; background:var(--accent,#e11d2e) }
</style>

{% schema %}
{
  "name": "Social proof — PRO",
  "target": "section",
  "settings": [
    { "type": "text", "id": "title", "label": "Title", "default": "Trusted by customers" },
    { "type": "textarea", "id": "subtitle", "label": "Subtitle" },

    {
      "type": "select", "id": "layout", "label": "Layout", "default": "grid",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "carousel", "label": "Carousel (scroll)" }
      ]
    },
    { "type": "range", "id": "columns", "label": "Columns (grid)", "min": 1, "max": 4, "step": 1, "default": 3 },

    { "type": "checkbox", "id": "show_rating", "label": "Show stars", "default": true },
    { "type": "checkbox", "id": "full_bleed", "label": "Edge-to-edge (100vw)", "default": false },

    {
      "type": "select", "id": "border_style", "label": "Card border style", "default": "soft",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "soft", "label": "Soft" },
        { "value": "glow", "label": "Accent glow" }
      ]
    },

    { "type": "range", "id": "radius", "label": "Card radius (px)", "min": 0, "max": 24, "step": 1, "default": 14 },
    { "type": "range", "id": "avatar_size", "label": "Avatar size (px)", "min": 24, "max": 64, "step": 2, "default": 40 },

    { "type": "color", "id": "bg", "label": "Section background", "default": "#f8fafc" },
    { "type": "color", "id": "fg", "label": "Text color", "default": "#111827" },
    { "type": "color", "id": "card_bg", "label": "Card background", "default": "#ffffff" },
    { "type": "color", "id": "accent", "label": "Accent / stars color", "default": "#e11d2e" },

    {
      "type": "textarea",
      "id": "items",
      "label": "Reviews (1 line = Text | Author | Role/city | Avatar URL | Rating/5)",
      "default": "Fast and careful service | Marie L. | Casablanca | https://cdn.shopify.com/s/files/.../avatar1.jpg | 5\nGreat prices, highly recommend | Yassine R. | Rabat | https://cdn.shopify.com/s/files/.../avatar2.jpg | 5\nTop quality, responsive support | Nadia K. | Marrakech | https://cdn.shopify.com/s/files/.../avatar3.jpg | 4"
    }
  ]
}
{% endschema %}
