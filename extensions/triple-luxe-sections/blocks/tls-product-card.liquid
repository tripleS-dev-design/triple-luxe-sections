{% assign p = all_products[block.settings.product] %}
{% if p %}
<section class="pcp"
  style="
    --pcp-accent: {{ block.settings.accent | default: '#ff5fa2' }};
    --pcp-bg: {{ block.settings.bg | default: '#ffffff' }};
    --pcp-card: {{ block.settings.card | default: '#ffffff' }};
    --pcp-radius: {{ block.settings.radius | default: 16 }}px;
    --pcp-gap: {{ block.settings.gap | default: 18 }}px;">
  <div class="pcp-wrap">
    <div class="pcp-gallery">
      {% assign first_media = p.featured_media | default: p.media.first %}
      {% if first_media %}
        {% assign main_alt = first_media.alt | default: p.title %}
        {{ first_media | image_url: width: 1500 | image_tag: class: 'pcp-main', alt: main_alt, loading: 'eager' }}
      {% endif %}
      {% if block.settings.show_thumbs and p.media.size > 1 %}
      <div class="pcp-thumbs" role="list">
        {% for m in p.media %}
          <button class="pcp-thumb{% if first_media and m.id == first_media.id %} is-active{% endif %}"
                  data-full="{{ m | image_url: width: 1500 }}"
                  aria-label="Voir l‚Äôimage {{ forloop.index }}">
            {% assign thumb_alt = m.alt | default: p.title %}
            {{ m | image_url: width: 180 | image_tag: alt: thumb_alt, loading: 'lazy' }}
          </button>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    {% assign v = p.selected_or_first_available_variant %}
    <div class="pcp-card">
      <header class="pcp-head">
        <h1 class="pcp-title">{{ p.title }}</h1>
        {% if v %}
          <div class="pcp-price">
            {% if v.compare_at_price > v.price %}
              <span class="pcp-price--sale">{{ v.price | money }}</span>
              <span class="pcp-price--compare">{{ v.compare_at_price | money }}</span>
              <span class="pcp-badge">Promo</span>
            {% else %}
              <span class="pcp-price--regular">{{ v.price | money }}</span>
            {% endif %}
          </div>
        {% endif %}
      </header>

      <div class="pcp-cta">
        <a href="{{ p.url }}" class="pcp-btn" aria-label="Voir le produit {{ p.title }}">Voir le produit</a>
        {% if block.settings.note != blank %}<p class="pcp-note">{{ block.settings.note }}</p>{% endif %}
      </div>

      {% if block.settings.show_bullets %}
      <ul class="pcp-bullets">
        <li>üöö Livraison dans toutes les wilayas</li>
        <li>üí≥ Paiement √† la livraison</li>
        <li>‚Ü©Ô∏è √âchange sous 7 jours</li>
        <li>‚≠ê Qualit√© premium</li>
      </ul>
      {% endif %}

      {% if block.settings.show_badges %}
      <div class="pcp-trust">
        <div class="pcp-chip">Paiement s√©curis√©</div>
        <div class="pcp-chip">Retour facile</div>
        <div class="pcp-chip">Support 7j/7</div>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="pcp-info">
    <div class="pcp-info__card">
      <h3>Description</h3>
      <div class="rte">{{ p.description | default: block.settings.desc | strip | default: "Robe √©l√©gante, tissu fluide et coupe flatteuse." }}</div>
    </div>
    <div class="pcp-info__card">
      <h3>Conseils & Entretien</h3>
      <p>{{ block.settings.care | default: "Lavage d√©licat 30¬∞, repassage doux sur l‚Äôenvers." }}</p>
    </div>
    <div class="pcp-info__card">
      <h3>Guide des tailles</h3>
      <p>{{ block.settings.size_guide | default: "Choisissez votre taille habituelle." }}</p>
    </div>
  </div>
</section>
{% else %}
<section class="pcp-missing">Choisissez un produit dans les r√©glages du block.</section>
{% endif %}

<style>
.pcp{background:var(--pcp-bg); padding:clamp(18px,3vw,28px) 0;}
.pcp-wrap{ width:min(1200px,94vw); margin:0 auto; display:grid; gap:var(--pcp-gap);
  grid-template-columns:minmax(340px,52%) 1fr; align-items:stretch;}
.pcp-gallery{background:#fff; border-radius:var(--pcp-radius); overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,.05);}
.pcp-main{display:block; width:100%; height:auto; aspect-ratio:16/10; object-fit:cover;}
.pcp-thumbs{display:flex; gap:10px; padding:10px; overflow:auto;}
.pcp-thumb{border:0; background:#fff; padding:0; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.06); cursor:pointer}
.pcp-thumb img{display:block; width:90px; height:90px; object-fit:cover; border-radius:10px}
.pcp-thumb.is-active{outline:2px solid var(--pcp-accent);}
.pcp-card{background:var(--pcp-card); border-radius:var(--pcp-radius); box-shadow:0 10px 30px rgba(0,0,0,.06);
  padding:clamp(14px,2vw,22px); display:flex; flex-direction:column; min-height:100%;}
.pcp-title{margin:0 0 .3rem; font-weight:900; font-size:clamp(1.25rem,2.4vw,1.6rem);}
.pcp-price{display:flex; align-items:center; gap:.65rem; margin-bottom:.6rem}
.pcp-price--sale{font-weight:800; color:var(--pcp-accent)}
.pcp-price--regular{font-weight:800}
.pcp-price--compare{opacity:.55; text-decoration:line-through}
.pcp-badge{background:var(--pcp-accent); color:#fff; font-size:.72rem; padding:.22rem .55rem; border-radius:999px; font-weight:800}
.pcp-cta{display:flex; flex-direction:column; gap:.5rem; margin:.2rem 0 .4rem}
.pcp-btn{ height:46px; border:0; border-radius:999px; cursor:pointer;
  background:linear-gradient(90deg,var(--pcp-accent),#ff9ecf); color:#fff; font-weight:900;
  box-shadow:0 10px 26px rgba(255,95,162,.28); transition:transform .12s ease, box-shadow .15s ease;
  display:inline-flex; align-items:center; justify-content:center; text-decoration:none; }
.pcp-btn:hover{ transform: translateY(-1px) }
.pcp-note{margin:0; font-size:.9rem; opacity:.8}
.pcp-bullets{margin:.8rem 0 0; padding:0; list-style:none; display:grid; gap:.45rem}
.pcp-bullets li{display:flex; gap:.5rem; align-items:center; font-weight:600}
.pcp-trust{display:flex; flex-wrap:wrap; gap:.5rem; margin:.8rem 0 0}
.pcp-chip{padding:.4rem .7rem; border-radius:999px; background:#f6f6f7; font-size:.85rem; font-weight:700}
.pcp-info{width:min(1200px,94vw); margin:clamp(14px,2.6vw,22px) auto 0; display:grid; gap:var(--pcp-gap); grid-template-columns:repeat(3,1fr);}
.pcp-info__card{background:#fff; border-radius:var(--pcp-radius); padding:clamp(12px,2vw,18px); box-shadow:0 6px 20px rgba(0,0,0,.05)}
.pcp-info__card h3{margin:.2rem 0 .6rem; font-size:1rem}
@media (max-width:990px){ .pcp-wrap{ grid-template-columns:1fr; } .pcp-info{ grid-template-columns:1fr; } }
</style>

<script>
document.addEventListener('click', function(e){
  const t = e.target.closest('.pcp-thumb'); if(!t) return;
  const main = t.closest('.pcp').querySelector('.pcp-main');
  const url = t.getAttribute('data-full');
  if(url && main){ main.src = url; main.srcset=''; }
  t.parentElement.querySelectorAll('.pcp-thumb').forEach(b=>b.classList.remove('is-active'));
  t.classList.add('is-active');
});
</script>

{% schema %}
{
  "name": "TLS ‚Äî Produit vitrine",
  "target": "section",
  "settings": [
    { "type": "product", "id": "product", "label": "Produit" },
    { "type": "checkbox", "id": "show_thumbs", "label": "Afficher les miniatures", "default": true },
    { "type": "checkbox", "id": "show_bullets", "label": "Afficher les avantages", "default": true },
    { "type": "checkbox", "id": "show_badges", "label": "Afficher les badges", "default": true },
    { "type": "text", "id": "note", "label": "Petit texte sous le bouton", "default": "Livraison dans toutes les wilayas üöö" },
    { "type": "textarea", "id": "desc", "label": "Description (fallback)" },
    { "type": "textarea", "id": "care", "label": "Conseils & entretien" },
    { "type": "textarea", "id": "size_guide", "label": "Guide des tailles" },
    { "type": "color", "id": "accent", "label": "Couleur accent", "default": "#ff5fa2" },
    { "type": "color", "id": "bg", "label": "Fond section", "default": "#ffffff" },
    { "type": "color", "id": "card", "label": "Fond carte", "default": "#ffffff" },
    { "type": "range", "id": "radius", "label": "Rayon", "min": 8, "max": 24, "step": 2, "default": 16 },
    { "type": "range", "id": "gap", "label": "Espace colonnes", "min": 12, "max": 32, "step": 2, "default": 18 }
  ]
}
{% endschema %}
