<section class="tls-kenburns
  {% if section.settings.full_bleed %} tls-kenburns--bleed{% endif %}
  {% if section.settings.full_screen %} tls-kenburns--fullscreen{% endif %}
">
  {% if section.settings.heading != blank %}
    <h2 class="tls-kenburns__title">{{ section.settings.heading }}</h2>
  {% endif %}

  {%- comment -%} Compter le nombre d’images valides {%- endcomment -%}
  {%- assign slide_count = 0 -%}
  {%- for i in (1..5) -%}
    {%- capture key -%}image_{{ i }}{%- endcapture -%}
    {%- assign img = section.settings[key] -%}
    {%- if img != blank -%}{%- assign slide_count = slide_count | plus: 1 -%}{%- endif -%}
  {%- endfor -%}

  <div class="tls-kenburns__wrap"
       style="--kb-speed: {{ section.settings.speed | default: 24 }}s;
              --kb-height: {{ section.settings.height | default: 520 }}px;
              --kb-count: {{ slide_count | default: 1 }};">
    {%- assign idx = 0 -%}
    {%- for i in (1..5) -%}
      {%- capture key -%}image_{{ i }}{%- endcapture -%}
      {%- assign img = section.settings[key] -%}
      {%- if img != blank -%}
        {%- assign idx = idx | plus: 1 -%}
        <figure class="tls-kenburns__slide" style="--i: {{ idx | minus: 1 }};" aria-hidden="true">
          {%- assign is_first = idx == 1 -%}
          {{ img
            | image_url: width: 2400
            | image_tag:
              class: 'tls-kenburns__img',
              alt: section.settings.heading | default: 'Banner',
              loading: is_first | default: true | ternary: 'eager', 'lazy',
              widths: '1200,1600,2000,2400',
              sizes: '100vw'
          }}
        </figure>
      {%- endif -%}
    {%- endfor -%}
  </div>
</section>

<style>
/* Container */
.tls-kenburns{position:relative;overflow:hidden;background:#000}
.tls-kenburns__title{text-align:center;margin:0 0 12px;font-weight:800;color:#fff}

/* Full-bleed largeur (bord à bord) */
.tls-kenburns--bleed{
  width:100vw; position:relative;
  left:calc(50% - 50vw); right:calc(50% - 50vw);
}

/* Stage */
.tls-kenburns__wrap{
  position:relative;
  width:100%;
  height: var(--kb-height, 520px);
  max-height: 90vh;
  overflow:hidden;
}

/* Mode plein écran (100vh) */
.tls-kenburns--fullscreen .tls-kenburns__wrap{
  height: 100vh; max-height:none;
}

/* Slides (plein écran, pile) */
.tls-kenburns__slide{
  position:absolute; inset:0;
  margin:0; opacity:0;
  animation-name: kb-fade;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  animation-duration: calc(var(--kb-speed) * var(--kb-count));
  animation-delay: calc(var(--i) * var(--kb-speed));
}

/* Image : couvre tout, zoom Ken Burns */
.tls-kenburns__img{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover; object-position:center;
  transform: scale(1);
  will-change: transform, opacity;
  animation-name: kb-zoom;
  animation-timing-function: ease-in-out;
  animation-iteration-count: infinite;
  animation-duration: calc(var(--kb-speed) * var(--kb-count));
  animation-delay: calc(var(--i) * var(--kb-speed));
}

/* Ken Burns (zoom doux) */
@keyframes kb-zoom{0%{transform:scale(1)}100%{transform:scale(1.08)}}

/* Fenêtre de visibilité */
@keyframes kb-fade{0%{opacity:1}72%{opacity:1}82%{opacity:0}100%{opacity:0}}

@media (max-width:990px){
  .tls-kenburns:not(.tls-kenburns--fullscreen) .tls-kenburns__wrap{
    height:min(60vw, var(--kb-height, 520px));
  }
}
</style>

{% schema %}
{
  "name": "Banner Ken Burns",
  "target": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Titre", "default": "Bannière" },

    { "type": "image_picker", "id": "image_1", "label": "Image 1" },
    { "type": "image_picker", "id": "image_2", "label": "Image 2" },
    { "type": "image_picker", "id": "image_3", "label": "Image 3" },
    { "type": "image_picker", "id": "image_4", "label": "Image 4" },
    { "type": "image_picker", "id": "image_5", "label": "Image 5" },

    { "type": "range", "id": "speed", "label": "Vitesse par image (s)", "min": 6, "max": 60, "step": 1, "default": 24 },
    { "type": "range", "id": "height", "label": "Hauteur (px)", "min": 280, "max": 1000, "step": 10, "default": 520 },
    { "type": "checkbox", "id": "full_screen", "label": "Plein écran (100vh)", "default": false },
    { "type": "checkbox", "id": "full_bleed", "label": "Bord à bord (largeur)", "default": true }
  ]
}
{% endschema %}
