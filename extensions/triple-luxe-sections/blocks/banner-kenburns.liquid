{% comment %} Bannière — Ken Burns (fondu) {% endcomment %}
<section
  id="kb-{{ section.id }}"
  class="kb"
  data-glow="{{ section.settings.enable_glow }}"
  style="
    --kb-h: {{ section.settings.height }}px;
    --kb-dur: {{ section.settings.duration }}s;
    --kb-zoom: {{ section.settings.zoom | divided_by: 100.0 }};
    --kb-glow: {{ section.settings.glow_color }};
    --kb-bg-from: {{ section.settings.bg_from }};
    --kb-bg-to: {{ section.settings.bg_to }};
  "
  aria-label="Bannière Ken Burns">
  <div class="kb-wrap">
    <div class="kb-viewport">
      <div class="kb-slides">
        {%- assign per_slide_delay = section.settings.duration | divided_by: 3 -%}

        {% for block in section.blocks %}
          {% if block.type == 'slide' %}
            {% assign panX = '2%' %}{% assign panY = '2%' %}
            {% case block.settings.motion %}
              {% when 'tl_br' %}{% assign panX = '2%'  %}{% assign panY = '2%'  %}
              {% when 'tr_bl' %}{% assign panX = '-2%' %}{% assign panY = '2%'  %}
              {% when 'bl_tr' %}{% assign panX = '2%'  %}{% assign panY = '-2%' %}
              {% when 'br_tl' %}{% assign panX = '-2%' %}{% assign panY = '-2%' %}
            {% endcase %}

            {% assign alt_text = block.settings.alt | default: block.settings.title | default: 'Bannière' %}

            <div class="kb-slide" style="--delay: {{ per_slide_delay | times: forloop.index0 }}s" {{ block.shopify_attributes }}>
              <div class="kb-ken" style="--panX: {{ panX }}; --panY: {{ panY }};">
                {% if block.settings.image != blank %}
                  {{ block.settings.image | image_url: width: 2400 | image_tag: class: 'kb-img', alt: alt_text }}
                {% else %}
                  <img class="kb-img" alt="Placeholder banner" src="https://cdn.shopify.com/s/files/1/0000/0001/files/placeholder-1200x600.png?v=1">
                {% endif %}

                {% if block.settings.title != blank or block.settings.subtitle != blank or block.settings.button_label != blank %}
                  <div class="kb-overlay">
                    {% if block.settings.title != blank %}<div class="kb-title">{{ block.settings.title }}</div>{% endif %}
                    {% if block.settings.subtitle != blank %}<div class="kb-sub">{{ block.settings.subtitle }}</div>{% endif %}
                    {% if block.settings.button_label != blank and block.settings.link != blank %}
                      <a class="kb-btn" href="{{ block.settings.link }}">{{ block.settings.button_label }}</a>
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <style>
    .kb{background: linear-gradient(180deg,var(--kb-bg-from,#EAF3FF),var(--kb-bg-to,#DFEEFF)); padding: 10px 0; border-bottom:1px solid rgba(26,74,138,.12)}
    .kb-wrap{max-width:1200px; margin:0 auto; padding:0 12px}
    .kb-viewport{position:relative; overflow:hidden; height:var(--kb-h,380px); border-radius:12px}
    .kb-slides{position:relative; height:100%}
    .kb-slide{position:absolute; inset:0; opacity:0; will-change: opacity; animation: kb-fade var(--kb-dur,15s) linear infinite; animation-delay: var(--delay,0s)}
    @keyframes kb-fade{0%{opacity:0}5%{opacity:1}30%{opacity:1}35%{opacity:0}100%{opacity:0}}
    .kb-ken{position:relative; width:100%; height:100%; overflow:hidden; border-radius:inherit}
    .kb[data-glow="true"] .kb-ken::before{content:""; position:absolute; inset:-12%; background: radial-gradient(40% 40% at 50% 50%, var(--kb-glow,#6EC1FF) 0%, rgba(110,193,255,0) 70%); filter: blur(20px); opacity:.40; pointer-events:none}
    .kb-img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; transform-origin:center center; animation: kb-zoom var(--kb-dur,15s) ease-in-out infinite; animation-delay: var(--delay,0s)}
    @keyframes kb-zoom{0%{transform: scale(1) translate(0,0)}100%{transform: scale(var(--kb-zoom,1.08)) translate(var(--panX,2%), var(--panY,2%))}}
    .kb-overlay{position:absolute; inset:0; display:grid; place-items:center; text-align:center; padding:18px; background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.12)); color:#fff; pointer-events:none}
    .kb-title{font-size:clamp(18px,2.6vw,28px); font-weight:800; letter-spacing:.3px; text-shadow:0 2px 12px rgba(0,0,0,.35)}
    .kb-sub{margin-top:6px; font-size:clamp(12px,1.6vw,14px); opacity:.95}
    .kb-btn{margin-top:12px; display:inline-block; padding:10px 16px; border-radius:999px; background:#1a4a8a; color:#fff; text-decoration:none; font-weight:700; pointer-events:auto; box-shadow:0 0 0 2px rgba(255,255,255,.15) inset, 0 6px 16px rgba(26,74,138,.35)}
    .kb-btn:hover{filter:brightness(1.08)}
    @media (max-width: 900px){.kb{padding:6px 0}.kb-viewport{height:calc(var(--kb-h,380px) * .78)}.kb-title{font-size:clamp(16px,3.6vw,24px)}}
  </style>

  {% schema %}
  {
    "name": "Bannière — Ken Burns (fondu)",
    "settings": [
      { "type": "range",  "id": "height",   "label": "Hauteur", "min": 200, "max": 600, "step": 4, "unit": "px", "default": 380 },
      { "type": "number", "id": "duration", "label": "Durée du cycle (s)", "default": 15 },
      { "type": "range",  "id": "zoom", "label": "Niveau de zoom (100=1.00)", "min": 100, "max": 200, "step": 1, "default": 108 },
      { "type": "color",  "id": "glow_color", "label": "Couleur du glow", "default": "#6EC1FF" },
      { "type": "color",  "id": "bg_from",    "label": "Fond (dégradé – haut)", "default": "#EAF3FF" },
      { "type": "color",  "id": "bg_to",      "label": "Fond (dégradé – bas)", "default": "#DFEEFF" },
      { "type": "checkbox","id": "enable_glow","label": "Activer l’effet lumineux (glow)", "default": true }
    ],
    "blocks": [
      { "type": "slide", "name": "Slide", "limit": 3,
        "settings": [
          { "type": "image_picker", "id": "image", "label": "Image" },
          { "type": "text", "id": "alt", "label": "Texte alternatif (SEO)", "default": "Bannière" },
          { "type": "text", "id": "title", "label": "Titre (optionnel)" },
          { "type": "text", "id": "subtitle", "label": "Sous-titre (optionnel)" },
          { "type": "text", "id": "button_label", "label": "Texte du bouton (optionnel)" },
          { "type": "url",  "id": "link", "label": "Lien du bouton (optionnel)" },
          { "type": "select", "id": "motion", "label": "Direction du mouvement", "default": "tl_br",
            "options": [
              { "value": "tl_br", "label": "Haut-Gauche → Bas-Droite" },
              { "value": "tr_bl", "label": "Haut-Droite → Bas-Gauche" },
              { "value": "bl_tr", "label": "Bas-Gauche → Haut-Droite" },
              { "value": "br_tl", "label": "Bas-Droite → Haut-Gauche" }
            ]
          }
        ]
      }
    ],
    "max_blocks": 3,
    "presets": [{ "name": "Bannière — Ken Burns (fondu)", "blocks": [ { "type": "slide" }, { "type": "slide" }, { "type": "slide" } ] }]
  }
  {% endschema %}
</section>
