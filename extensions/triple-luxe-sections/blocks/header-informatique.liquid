{% comment %}
  TLX — Header Pro (Utility + Quick Links + Mega Menu)
  - Options :
    • Sticky + ombre au scroll
    • Mode transparent (utile sur Hero)
    • Couleurs (fond haut/bas, texte, icônes, bordures)
    • Logo image + hauteur, fallback texte
    • Recherche (produits)
    • Icônes : Wishlist, Compare, Panier (badge), Compte (si activé)
    • Quick links (liens simples)
    • Mega menu (menu Shopify + 4 colonnes optionnelles)
  - Accessibilité : ARIA labels, rôles, focus states
{% endcomment %}

<section
  class="tlx-header {% if section.settings.sticky %}tlx-header--sticky{% endif %} {% if section.settings.transparent %}tlx-header--transparent{% endif %}"
  style="--hd-bg-top: {{ section.settings.bg_top }}; --hd-bg-bottom: {{ section.settings.bg_bottom }}; --hd-fg: {{ section.settings.fg }}; --hd-icon: {{ section.settings.icon_color }}; --hd-border: {{ section.settings.border_color }};"
>
  <div class="tlx-header__inner {% if section.settings.full_width == false %}tlx-container{% endif %}">
    <!-- TOP BAR -->
    <div class="tlx-header__top">
      <!-- LOGO -->
      <div class="tlx-header__logo">
        <a href="{{ routes.root_url }}" class="tlx-logo" aria-label="{{ section.settings.store_name | escape }}">
          {% if section.settings.logo != blank %}
            {{ section.settings.logo | image_url: width: 300 | image_tag:
              alt: section.settings.store_name,
              class: 'tlx-logo__img',
              widths: '120,180,240,300',
              height: section.settings.logo_height,
              style: 'height:' | append: section.settings.logo_height | append:'px'
            }}
          {% else %}
            <span class="tlx-logo__fallback">{{ section.settings.store_name }}</span>
          {% endif %}
        </a>
      </div>

      <!-- SEARCH -->
      {% if section.settings.show_search %}
      <div class="tlx-header__search">
        <form action="{{ routes.search_url }}" method="get" role="search" class="tlx-search" aria-label="Recherche produits">
          <input type="search" name="q" value="{{ search.terms | escape }}" placeholder="{{ section.settings.search_placeholder | escape }}" class="tlx-search__input" />
          <input type="hidden" name="type" value="product">
          <button type="submit" class="tlx-search__btn" aria-label="{{ 'general.search.search' | t | default: 'Rechercher' }}">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" role="img" aria-hidden="true">
              <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.7"></circle>
              <path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"></path>
            </svg>
          </button>
        </form>
      </div>
      {% endif %}

      <!-- UTILS -->
      <div class="tlx-header__utils">
        {% if section.settings.show_wishlist %}
          <a href="{{ section.settings.wishlist_url | default: routes.root_url }}" class="tlx-util" aria-label="{{ section.settings.wishlist_label | escape }}">
            <span class="tlx-util__icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M20.8 8.6c0 5.7-8.8 9.8-8.8 9.8S3.2 14.3 3.2 8.6A4.6 4.6 0 0112 7.4a4.6 4.6 0 018.8 1.2z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
            </span>
            {% if section.settings.show_labels_desktop %}<span class="tlx-util__label">{{ section.settings.wishlist_label }}</span>{% endif %}
            {% if section.settings.show_zero_badges %}<span class="tlx-badge">0</span>{% endif %}
          </a>
        {% endif %}

        {% if section.settings.show_compare %}
          <a href="{{ section.settings.compare_url | default: routes.root_url }}" class="tlx-util" aria-label="{{ section.settings.compare_label | escape }}">
            <span class="tlx-util__icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M7 4h3v16H7zM14 8h3v12h-3z" stroke="currentColor" stroke-width="1.6" /></svg>
            </span>
            {% if section.settings.show_labels_desktop %}<span class="tlx-util__label">{{ section.settings.compare_label }}</span>{% endif %}
            {% if section.settings.show_zero_badges %}<span class="tlx-badge">0</span>{% endif %}
          </a>
        {% endif %}

        <a href="{{ routes.cart_url }}" class="tlx-util" aria-label="{{ section.settings.cart_label | escape }}">
          <span class="tlx-util__icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M3 4h2l2.5 12H19l2-8H7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="10" cy="20" r="1.6" fill="currentColor"></circle>
              <circle cx="17" cy="20" r="1.6" fill="currentColor"></circle>
            </svg>
          </span>
          {% if section.settings.show_labels_desktop %}<span class="tlx-util__label">{{ section.settings.cart_label }}</span>{% endif %}
          {% if cart != empty and cart.item_count > 0 %}
            <span class="tlx-badge" aria-label="{{ cart.item_count }} {{ 'sections.cart.items_count' | t | default: 'articles' }}">{{ cart.item_count }}</span>
          {% endif %}
        </a>

        {% if section.settings.show_account and shop.customer_accounts_enabled %}
          <a href="{{ routes.account_url }}" class="tlx-util" aria-label="{{ section.settings.account_label | escape }}">
            <span class="tlx-util__icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="8" r="3.2" stroke="currentColor" stroke-width="1.6"/>
                <path d="M5 19a7 7 0 0114 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </span>
            {% if section.settings.show_labels_desktop %}<span class="tlx-util__label">{{ section.settings.account_label }}</span>{% endif %}
          </a>
        {% endif %}

        <!-- MOBILE HAMBURGER -->
        <button class="tlx-burger" aria-label="Ouvrir le menu" aria-expanded="false" aria-controls="tlx-nav">
          <span class="tlx-burger__bar" aria-hidden="true"></span>
          <span class="tlx-burger__bar" aria-hidden="true"></span>
          <span class="tlx-burger__bar" aria-hidden="true"></span>
        </button>
      </div>
    </div>

    <!-- BOTTOM NAV -->
    <div class="tlx-header__bottom">
      <nav id="tlx-nav" class="tlx-nav" aria-label="Navigation principale">
        <ul class="tlx-nav__list">
          {% for block in section.blocks %}
            {% case block.type %}

              {% when 'quick_link' %}
                <li class="tlx-nav__item" {{ block.shopify_attributes }}>
                  <a href="{{ block.settings.url | default: '#' }}" class="tlx-ql">
                    {% if block.settings.icon != 'none' %}
                      <span class="tlx-ql__icon" aria-hidden="true">
                        {% case block.settings.icon %}
                          {% when 'menu' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
                          {% when 'tag' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M20 13l-7 7-9-9V4h7l9 9z" stroke="currentColor" stroke-width="1.6"/><circle cx="7.5" cy="7.5" r="1.5" fill="currentColor"/></svg>
                          {% when 'doc' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12V8l-4-6z" stroke="currentColor" stroke-width="1.6"/><path d="M14 2v6h6" stroke="currentColor" stroke-width="1.6"/></svg>
                          {% when 'blog' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 5h16v14H4z" stroke="currentColor" stroke-width="1.6"/><path d="M9 5v14M4 9h5M9 9h11" stroke="currentColor" stroke-width="1.6"/></svg>
                          {% else %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="1.6"/></svg>
                        {% endcase %}
                      </span>
                    {% endif %}
                    <span class="tlx-ql__text">{{ block.settings.label }}</span>
                    {% if block.settings.show_caret %}<svg class="tlx-ql__caret" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 10l4 4 4-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>{% endif %}
                  </a>
                </li>

              {% when 'mega_menu' %}
                <li class="tlx-nav__item tlx-mega" {{ block.shopify_attributes }}>
                  <button class="tlx-mega__toggle" aria-expanded="false">
                    <span>{{ block.settings.title }}</span>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 10l4 4 4-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  </button>
                  <div class="tlx-mega__panel" role="region" aria-label="{{ block.settings.title | escape }}">
                    <div class="tlx-mega__content {% if section.settings.full_width == false %}tlx-container{% endif %}">
                      <!-- Menu principal choisi -->
                      {% if block.settings.menu %}
                        <ul class="tlx-mega__menu">
                          {% for link in block.settings.menu.links %}
                            <li class="tlx-mega__menu-item">
                              <a href="{{ link.url }}">{{ link.title }}</a>
                            </li>
                          {% endfor %}
                        </ul>
                      {% endif %}

                      <!-- 4 colonnes optionnelles -->
                      <div class="tlx-mega__cols">
                        {% for i in (1..4) %}
                          {% assign col_title = block.settings["col" | append: i | append: "_title"] %}
                          {% assign col_menu = block.settings["col" | append: i | append: "_menu"] %}
                          {% if col_title != blank or col_menu != blank %}
                            <div class="tlx-mega__col">
                              {% if col_title != blank %}<h4 class="tlx-mega__col-title">{{ col_title }}</h4>{% endif %}
                              {% if col_menu %}
                                <ul class="tlx-mega__col-list">
                                  {% for link in col_menu.links %}
                                    <li><a href="{{ link.url }}">{{ link.title }}</a></li>
                                  {% endfor %}
                                </ul>
                              {% endif %}
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </li>

            {% endcase %}
          {% endfor %}
        </ul>
      </nav>
    </div>
  </div>
</section>

<style>
  .tlx-container{max-width:{{ section.settings.container_max | default: 1200 }}px;margin:0 auto;padding:0 16px}
  .tlx-header{--_bg-top:var(--hd-bg-top,#ffffff);--_bg-bottom:var(--hd-bg-bottom,#ffffff);--_fg:var(--hd-fg,#111827);--_icon:var(--hd-icon,#111827);--_border:var(--hd-border,#e5e7eb)}
  .tlx-header{background:linear-gradient(0deg,var(--_bg-bottom),var(--_bg-top));color:var(--_fg);border-bottom:1px solid var(--_border)}
  .tlx-header--transparent{background:transparent;border-color:transparent}
  .tlx-header--sticky{position:sticky;top:0;z-index:50}
  .tlx-header__inner{display:block}
  .tlx-header__top{display:grid;grid-template-columns: 1fr 2fr 1fr;gap:16px;align-items:center;padding:10px 0}
  .tlx-header__bottom{border-top:1px solid var(--_border);padding:8px 0}
  .tlx-logo{display:inline-flex;align-items:center;gap:10px;text-decoration:none;color:var(--_fg)}
  .tlx-logo__img{display:block}
  .tlx-logo__fallback{font-weight:800;font-size:18px;letter-spacing:.3px;color:var(--_fg)}
  .tlx-search{display:flex;width:100%;background:#fff;border:1px solid var(--_border);border-radius:6px;overflow:hidden}
  .tlx-header--transparent .tlx-search{background:rgba(255,255,255,.92);backdrop-filter:saturate(120%) blur(6px)}
  .tlx-search__input{flex:1;padding:10px 12px;border:0;outline:0;font-size:14px}
  .tlx-search__btn{display:inline-flex;align-items:center;justify-content:center;width:44px;border:0;background:var(--_icon);color:#fff;cursor:pointer}
  .tlx-header__utils{display:flex;justify-content:flex-end;gap:14px;align-items:center}
  .tlx-util{display:inline-flex;align-items:center;gap:6px;position:relative;text-decoration:none;color:var(--_fg)}
  .tlx-util__icon{display:inline-flex;color:var(--_icon)}
  .tlx-util__label{font-size:13px}
  .tlx-badge{position:absolute;top:-6px;right:-8px;min-width:18px;height:18px;padding:0 5px;background:var(--_icon);color:#fff;border-radius:12px;font-size:12px;display:inline-flex;align-items:center;justify-content:center;line-height:1}
  .tlx-burger{display:none;background:transparent;border:1px solid var(--_border);border-radius:6px;padding:7px 8px;cursor:pointer}
  .tlx-burger__bar{display:block;width:18px;height:2px;background:var(--_fg);margin:3px 0}
  .tlx-nav{display:block}
  .tlx-nav__list{display:flex;gap:28px;flex-wrap:wrap;align-items:center;margin:0;padding:0;list-style:none}
  .tlx-ql{display:inline-flex;align-items:center;gap:8px;text-decoration:none;color:var(--_fg);position:relative;padding:6px 0}
  .tlx-ql__icon{display:inline-flex;color:var(--_icon)}
  .tlx-ql__text{font-size:14px}
  .tlx-ql__caret{margin-left:-2px;color:var(--_icon)}
  /* Mega menu */
  .tlx-mega{position:relative}
  .tlx-mega__toggle{display:inline-flex;align-items:center;gap:6px;background:transparent;border:0;padding:6px 0;font-size:14px;color:var(--_fg);cursor:pointer}
  .tlx-mega__panel{position:absolute;left:0;right:0;top:100%;background:#fff;border:1px solid var(--_border);box-shadow:0 18px 40px rgba(0,0,0,.07);opacity:0;pointer-events:none;transform:translateY(8px);transition:.18s ease;will-change:transform,opacity}
  .tlx-mega:hover .tlx-mega__panel,
  .tlx-mega__toggle[aria-expanded="true"] + .tlx-mega__panel{opacity:1;pointer-events:auto;transform:translateY(0)}
  .tlx-mega__content{padding:18px}
  .tlx-mega__menu{display:flex;gap:18px;margin:0 0 12px;padding:0;list-style:none;flex-wrap:wrap}
  .tlx-mega__menu-item a{text-decoration:none;color:var(--_fg);font-weight:600}
  .tlx-mega__cols{display:grid;grid-template-columns: repeat(4, minmax(0,1fr));gap:16px}
  .tlx-mega__col-title{font-size:13px;font-weight:700;margin:6px 0 8px}
  .tlx-mega__col-list{list-style:none;margin:0;padding:0}
  .tlx-mega__col-list a{text-decoration:none;color:var(--_fg);font-size:14px}
  /* Sticky shadow on scroll */
  .tlx-header--sticky.tlx--scrolled{box-shadow:0 8px 24px rgba(0,0,0,.06)}
  /* Responsive */
  @media (max-width: {{ section.settings.breakpoint | default: 990 }}px){
    .tlx-header__top{grid-template-columns:1fr auto 1fr}
    .tlx-header__search{grid-column:1/-1;order:3;margin-top:8px}
    .tlx-header__utils{justify-content:flex-end}
    .tlx-util__label{display:none}
    .tlx-burger{display:inline-flex}
    .tlx-nav{display:none}
    .tlx-nav.tlx--open{display:block}
    .tlx-header__bottom{border-top:1px solid var(--_border)}
    .tlx-nav__list{flex-direction:column;gap:10px;align-items:flex-start;padding:6px 0}
    .tlx-mega__panel{position:static;opacity:1;pointer-events:auto;transform:none;border:0;box-shadow:none;padding:0;background:transparent}
    .tlx-mega__content{padding:6px 0}
    .tlx-mega__cols{grid-template-columns:1fr 1fr}
  }
</style>

<script>
  (function(){
    const header = document.currentScript.closest('.tlx-header');
    const burger = header.querySelector('.tlx-burger');
    const nav = header.querySelector('#tlx-nav');
    if(burger && nav){
      burger.addEventListener('click', function(){
        const open = nav.classList.toggle('tlx--open');
        burger.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    }
    // Sticky shadow on scroll
    if(header.classList.contains('tlx-header--sticky')){
      const onScroll = () => {
        if(window.scrollY > 6){ header.classList.add('tlx--scrolled'); }
        else { header.classList.remove('tlx--scrolled'); }
      };
      document.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    }
    // Mega toggle (keyboard/mobile)
    header.querySelectorAll('.tlx-mega__toggle').forEach(function(btn){
      btn.addEventListener('click', function(){
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
      });
    });
  })();
</script>

{% schema %}
{
  "name": "TLX — Header Pro",
  "class": "section-tlx-header-pro",
  "settings": [
    { "type": "checkbox", "id": "full_width", "label": "Pleine largeur", "default": false },
    { "type": "range", "id": "container_max", "min": 960, "max": 1600, "step": 20, "unit": "px", "label": "Largeur max du conteneur", "default": 1200 },
    { "type": "checkbox", "id": "sticky", "label": "Header collant (sticky)", "default": true },
    { "type": "checkbox", "id": "transparent", "label": "Mode transparent (sur Hero)", "default": false },
    { "type": "range", "id": "breakpoint", "min": 720, "max": 1200, "step": 10, "unit": "px", "label": "Breakpoint mobile", "default": 990 },

    { "type": "header", "content": "Logo" },
    { "type": "image_picker", "id": "logo", "label": "Logo (optionnel)" },
    { "type": "range", "id": "logo_height", "label": "Hauteur du logo (px)", "min": 24, "max": 80, "step": 2, "default": 36 },
    { "type": "text", "id": "store_name", "label": "Nom de la boutique (fallback)", "default": "Votre Boutique" },

    { "type": "header", "content": "Recherche" },
    { "type": "checkbox", "id": "show_search", "label": "Afficher la recherche", "default": true },
    { "type": "text", "id": "search_placeholder", "label": "Placeholder recherche", "default": "Chercher des produits" },

    { "type": "header", "content": "Icônes (droite)" },
    { "type": "checkbox", "id": "show_labels_desktop", "label": "Afficher libellés sur desktop", "default": true },
    { "type": "checkbox", "id": "show_wishlist", "label": "Afficher Wishlist", "default": true },
    { "type": "url", "id": "wishlist_url", "label": "Lien Wishlist (page/app)" },
    { "type": "text", "id": "wishlist_label", "label": "Libellé Wishlist", "default": "Liste de souhaits" },
    { "type": "checkbox", "id": "show_compare", "label": "Afficher Comparateur", "default": true },
    { "type": "url", "id": "compare_url", "label": "Lien Comparateur (page/app)" },
    { "type": "text", "id": "compare_label", "label": "Libellé Comparateur", "default": "Comparateur" },
    { "type": "text", "id": "cart_label", "label": "Libellé Panier", "default": "Mon panier" },
    { "type": "checkbox", "id": "show_account", "label": "Afficher Compte (si activé)", "default": true },
    { "type": "text", "id": "account_label", "label": "Libellé Compte", "default": "Mon compte" },
    { "type": "checkbox", "id": "show_zero_badges", "label": "Badges 0 (Wishlist/Compare)", "default": false },

    { "type": "header", "content": "Couleurs" },
    { "type": "color", "id": "bg_top", "label": "Fond (haut)", "default": "#ffffff" },
    { "type": "color", "id": "bg_bottom", "label": "Fond (bas)", "default": "#ffffff" }
    
  ],
  "blocks": [
    {
      "type": "quick_link",
      "name": "Lien rapide",
      "settings": [
        { "type": "select", "id": "icon", "label": "Icône", "default": "none",
          "options": [
            { "value": "none", "label": "Aucune" },
            { "value": "menu", "label": "Menu/Produits" },
            { "value": "tag", "label": "Promotion" },
            { "value": "doc", "label": "Devis (doc)" },
            { "value": "blog", "label": "Blog/Mag" }
          ]
        },
        { "type": "text", "id": "label", "label": "Texte", "default": "Produits" },
        { "type": "url", "id": "url", "label": "Lien" },
        { "type": "checkbox", "id": "show_caret", "label": "Afficher caret (▼)", "default": false }
      ]
    },
    {
      "type": "mega_menu",
      "name": "Mega menu",
      "settings": [
        { "type": "text", "id": "title", "label": "Titre (bouton)", "default": "Collections" },
        { "type": "link_list", "id": "menu", "label": "Menu principal (ligne du haut)" },

        { "type": "header", "content": "Colonnes (optionnelles)" },
        { "type": "text", "id": "col1_title", "label": "Colonne 1 — Titre" },
        { "type": "link_list", "id": "col1_menu", "label": "Colonne 1 — Menu" },

        { "type": "text", "id": "col2_title", "label": "Colonne 2 — Titre" },
        { "type": "link_list", "id": "col2_menu", "label": "Colonne 2 — Menu" },

        { "type": "text", "id": "col3_title", "label": "Colonne 3 — Titre" },
        { "type": "link_list", "id": "col3_menu", "label": "Colonne 3 — Menu" },

        { "type": "text", "id": "col4_title", "label": "Colonne 4 — Titre" },
        { "type": "link_list", "id": "col4_menu", "label": "Colonne 4 — Menu" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "TLX — Header Pro",
      "blocks": [
        { "type": "quick_link", "settings": { "icon": "menu", "label": "Produits", "url": "/collections" } },
        { "type": "quick_link", "settings": { "icon": "tag",  "label": "Promotions", "url": "/collections/sale" } },
        { "type": "mega_menu", "settings": { "title": "Collections" } }
      ]
    }
  ]
}
{% endschema %}
